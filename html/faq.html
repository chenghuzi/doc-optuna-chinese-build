

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FAQ &mdash; Optuna 1.4.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Visualization" href="reference/visualization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Optuna
          

          
          </a>

          
            
            
              <div class="version">
                1.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#optuna">某某库可以和 Optuna 配合使用吗？（某某是你最爱的机器学习库）</a></li>
<li class="toctree-l2"><a class="reference internal" href="#objective-func-additional-args">如何定义带有独有参数的目标函数？</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rdb-optuna">没有远程 RDB 的情况下可以使用 Optuna 吗？</a></li>
<li class="toctree-l2"><a class="reference internal" href="#study">如何保存和恢复 study？</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">如何禁用 Optuna 的日志信息？</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-save-machine-learning-models-trained-in-objective-functions">How to save machine learning models trained in objective functions?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-obtain-reproducible-optimization-results">How can I obtain reproducible optimization results?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-are-exceptions-from-trials-handled">How are exceptions from trials handled?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-are-nans-returned-by-trials-handled">How are NaNs returned by trials handled?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-happens-when-i-dynamically-alter-a-search-space">What happens when I dynamically alter a search space?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-use-two-gpus-for-evaluating-two-trials-simultaneously">How can I use two GPUs for evaluating two trials simultaneously?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-test-my-objective-functions">How can I test my objective functions?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Optuna</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>FAQ</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/faq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="faq">
<h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#optuna" id="id3">某某库可以和 Optuna 配合使用吗？（某某是你最爱的机器学习库）</a></p></li>
<li><p><a class="reference internal" href="#objective-func-additional-args" id="id4">如何定义带有独有参数的目标函数？</a></p></li>
<li><p><a class="reference internal" href="#rdb-optuna" id="id5">没有远程 RDB 的情况下可以使用 Optuna 吗？</a></p></li>
<li><p><a class="reference internal" href="#study" id="id6">如何保存和恢复 study？</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id7">如何禁用 Optuna 的日志信息？</a></p></li>
<li><p><a class="reference internal" href="#how-to-save-machine-learning-models-trained-in-objective-functions" id="id8">How to save machine learning models trained in objective functions?</a></p></li>
<li><p><a class="reference internal" href="#how-can-i-obtain-reproducible-optimization-results" id="id9">How can I obtain reproducible optimization results?</a></p></li>
<li><p><a class="reference internal" href="#how-are-exceptions-from-trials-handled" id="id10">How are exceptions from trials handled?</a></p></li>
<li><p><a class="reference internal" href="#how-are-nans-returned-by-trials-handled" id="id11">How are NaNs returned by trials handled?</a></p></li>
<li><p><a class="reference internal" href="#what-happens-when-i-dynamically-alter-a-search-space" id="id12">What happens when I dynamically alter a search space?</a></p></li>
<li><p><a class="reference internal" href="#how-can-i-use-two-gpus-for-evaluating-two-trials-simultaneously" id="id13">How can I use two GPUs for evaluating two trials simultaneously?</a></p></li>
<li><p><a class="reference internal" href="#how-can-i-test-my-objective-functions" id="id14">How can I test my objective functions?</a></p></li>
</ul>
</div>
<div class="section" id="optuna">
<h2><a class="toc-backref" href="#id3">某某库可以和 Optuna 配合使用吗？（某某是你最爱的机器学习库）</a><a class="headerlink" href="#optuna" title="Permalink to this headline">¶</a></h2>
<p>Optuna 和绝大多数ML库兼容，并且很容易同他们配合使用。
参见 <a class="reference external" href="https://github.com/optuna/optuna/tree/master/examples">examples</a>.</p>
</div>
<div class="section" id="objective-func-additional-args">
<span id="id1"></span><h2><a class="toc-backref" href="#id4">如何定义带有独有参数的目标函数？</a><a class="headerlink" href="#objective-func-additional-args" title="Permalink to this headline">¶</a></h2>
<p>有两种方法可以实现这类函数。</p>
<p>首先，如下的可调用的 objective 类具有这个功能：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">optuna</span>

<span class="k">class</span> <span class="nc">Objective</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">):</span>
        <span class="c1"># Hold this implementation specific arguments as the fields of the class.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_x</span> <span class="o">=</span> <span class="n">min_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_x</span> <span class="o">=</span> <span class="n">max_x</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">):</span>
        <span class="c1"># Calculate an objective value by using the extra arguments.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_uniform</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_x</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># 通过使用一个 `Objective` 实例来执行优化过程。</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">Objective</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>其次，你可以用 <code class="docutils literal notranslate"><span class="pre">lambda</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 来创建带有额外参数的函数（闭包）。
下面是一个使用了 <code class="docutils literal notranslate"><span class="pre">lambda</span></code> 的例子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">optuna</span>

<span class="c1"># 带有三个参数的目标函数。</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_uniform</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># 额外参数。</span>
<span class="n">min_x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
<span class="n">max_x</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># 通过 `lambda` 将目标函数包起来用于优化过程。</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>其他例子参见 <a class="reference external" href="https://github.com/optuna/optuna/blob/master/examples/sklearn_additional_args.py">sklearn_addtitional_args.py</a> .</p>
</div>
<div class="section" id="rdb-optuna">
<h2><a class="toc-backref" href="#id5">没有远程 RDB 的情况下可以使用 Optuna 吗？</a><a class="headerlink" href="#rdb-optuna" title="Permalink to this headline">¶</a></h2>
<p>可以。</p>
<p>在最简单的情况下，Optuna 使用内存 (in-memory) 存储：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你想能保存和恢复 study 的化，将 SQLite 作为本地存储也是很方便的：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="s1">&#39;foo_study&#39;</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;sqlite:///example.db&#39;</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>  <span class="c1"># The state of `study` will be persisted to the local SQLite file.</span>
</pre></div>
</div>
<p>更多细节请参考 <a class="reference internal" href="tutorial/rdb.html#rdb"><span class="std std-ref">用 RDB 后端保存/恢复 Study</span></a>.</p>
</div>
<div class="section" id="study">
<h2><a class="toc-backref" href="#id6">如何保存和恢复 study？</a><a class="headerlink" href="#study" title="Permalink to this headline">¶</a></h2>
<p>有两种方法可以将 study 持久化。具体采用哪种取决于你是使用内存存储 (in-memory) 还是远程数据库存储 (RDB).
通过 <code class="docutils literal notranslate"><span class="pre">pickle</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">joblib</span></code>, 采用了内存存储的 study 可以和普通的 Python 对象一样被存储和加载。
比如用 <code class="docutils literal notranslate"><span class="pre">joblib</span></code> 的话：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="s1">&#39;study.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>恢复 study:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;study.pkl&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best trial until now:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Value: &#39;</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Params: &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你用的是 RDB, 具体细节请参考 <a class="reference internal" href="tutorial/rdb.html#rdb"><span class="std std-ref">用 RDB 后端保存/恢复 Study</span></a>.</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id7">如何禁用 Optuna 的日志信息？</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>默认情况下，Optuna 打印处于 <code class="docutils literal notranslate"><span class="pre">optuna.logging.INFO</span></code> 层级的日志信息。
通过设置  <a class="reference internal" href="reference/logging.html#optuna.logging.set_verbosity" title="optuna.logging.set_verbosity"><code class="xref py py-func docutils literal notranslate"><span class="pre">optuna.logging.set_verbosity()</span></code></a>, 你可以改变这个层级。</p>
<p>比如，下面的代码可以终止打印每一个trial的结果：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">optuna</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<span class="c1"># Logs like &#39;[I 2018-12-05 11:41:42,324] Finished a trial resulted in value:...&#39; are disabled.</span>
</pre></div>
</div>
<p>更多的细节请参考  <a class="reference internal" href="reference/logging.html#module-optuna.logging" title="optuna.logging"><code class="xref py py-class docutils literal notranslate"><span class="pre">optuna.logging</span></code></a>.</p>
</div>
<div class="section" id="how-to-save-machine-learning-models-trained-in-objective-functions">
<h2><a class="toc-backref" href="#id8">How to save machine learning models trained in objective functions?</a><a class="headerlink" href="#how-to-save-machine-learning-models-trained-in-objective-functions" title="Permalink to this headline">¶</a></h2>
<p>Optuna saves hyperparameter values with its corresponding objective value to storage,
but it discards intermediate objects such as machine learning models and neural network weights.
To save models or weights, please use features of the machine learning library you used.</p>
<p>We recommend saving <a class="reference internal" href="reference/trial.html#optuna.trial.Trial.number" title="optuna.trial.Trial.number"><code class="xref py py-obj docutils literal notranslate"><span class="pre">optuna.trial.Trial.number</span></code></a> with a model in order to identify its corresponding trial.
For example, you can save SVM models trained in the objective function as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">svc_c</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_loguniform</span><span class="p">(</span><span class="s1">&#39;svc_c&#39;</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">)</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">svc_c</span><span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Save a trained model to a file.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.pickle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">))</span>


<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">()</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Load the best model.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.pickle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">best_clf</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">best_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-obtain-reproducible-optimization-results">
<h2><a class="toc-backref" href="#id9">How can I obtain reproducible optimization results?</a><a class="headerlink" href="#how-can-i-obtain-reproducible-optimization-results" title="Permalink to this headline">¶</a></h2>
<p>To make the parameters suggested by Optuna reproducible, you can specify a fixed random seed via <code class="docutils literal notranslate"><span class="pre">seed</span></code> argument of <a class="reference internal" href="reference/samplers.html#optuna.samplers.RandomSampler" title="optuna.samplers.RandomSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomSampler</span></code></a> or <a class="reference internal" href="reference/samplers.html#optuna.samplers.TPESampler" title="optuna.samplers.TPESampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">TPESampler</span></code></a> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Make the sampler behave in a deterministic way.</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
</pre></div>
</div>
<p>However, there are two caveats.</p>
<p>First, when optimizing a study in distributed or parallel mode, there is inherent non-determinism.
Thus it is very difficult to reproduce the same results in such condition.
We recommend executing optimization of a study sequentially if you would like to reproduce the result.</p>
<p>Second, if your objective function behaves in a non-deterministic way (i.e., it does not return the same value even if the same parameters were suggested), you cannot reproduce an optimization.
To deal with this problem, please set an option (e.g., random seed) to make the behavior deterministic if your optimization target (e.g., an ML library) provides it.</p>
</div>
<div class="section" id="how-are-exceptions-from-trials-handled">
<h2><a class="toc-backref" href="#id10">How are exceptions from trials handled?</a><a class="headerlink" href="#how-are-exceptions-from-trials-handled" title="Permalink to this headline">¶</a></h2>
<p>Trials that raise exceptions without catching them will be treated as failures, i.e. with the <a class="reference internal" href="reference/trial.html#optuna.trial.TrialState.FAIL" title="optuna.trial.TrialState.FAIL"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FAIL</span></code></a> status.</p>
<p>By default, all exceptions except <a class="reference internal" href="reference/exceptions.html#optuna.exceptions.TrialPruned" title="optuna.exceptions.TrialPruned"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrialPruned</span></code></a> raised in objective functions are propagated to the caller of <a class="reference internal" href="reference/study.html#optuna.study.Study.optimize" title="optuna.study.Study.optimize"><code class="xref py py-func docutils literal notranslate"><span class="pre">optimize()</span></code></a>.
In other words, studies are aborted when such exceptions are raised.
It might be desirable to continue a study with the remaining trials.
To do so, you can specify in <a class="reference internal" href="reference/study.html#optuna.study.Study.optimize" title="optuna.study.Study.optimize"><code class="xref py py-func docutils literal notranslate"><span class="pre">optimize()</span></code></a> which exception types to catch using the <code class="docutils literal notranslate"><span class="pre">catch</span></code> argument.
Exceptions of these types are caught inside the study and will not propagate further.</p>
<p>You can find the failed trials in log messages.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>W <span class="m">2018</span>-12-07 <span class="m">16</span>:38:36,889<span class="o">]</span> Setting status of trial#0 as TrialState.FAIL because of <span class="se">\</span>
the following error: ValueError<span class="o">(</span><span class="s1">&#39;A sample error in objective.&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>You can also find the failed trials by checking the trial states as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span><span class="o">.</span><span class="n">trials_dataframe</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>number</p></td>
<td><p>state</p></td>
<td><p>value</p></td>
<td><p>…</p></td>
<td><p>params</p></td>
<td><p>system_attrs</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>TrialState.FAIL</p></td>
<td></td>
<td><p>…</p></td>
<td><p>0</p></td>
<td><p>Setting status of trial#0 as TrialState.FAIL because of the following error: ValueError(‘A test error in objective.’)</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>TrialState.COMPLETE</p></td>
<td><p>1269</p></td>
<td><p>…</p></td>
<td><p>1</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <code class="docutils literal notranslate"><span class="pre">catch</span></code> argument in <a class="reference internal" href="reference/study.html#optuna.study.Study.optimize" title="optuna.study.Study.optimize"><code class="xref py py-func docutils literal notranslate"><span class="pre">optimize()</span></code></a>.</p>
</div>
</div>
<div class="section" id="how-are-nans-returned-by-trials-handled">
<h2><a class="toc-backref" href="#id11">How are NaNs returned by trials handled?</a><a class="headerlink" href="#how-are-nans-returned-by-trials-handled" title="Permalink to this headline">¶</a></h2>
<p>Trials that return <code class="xref py py-obj docutils literal notranslate"><span class="pre">NaN</span></code> (<code class="docutils literal notranslate"><span class="pre">float('nan')</span></code>) are treated as failures, but they will not abort studies.</p>
<p>Trials which return <code class="xref py py-obj docutils literal notranslate"><span class="pre">NaN</span></code> are shown as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>W <span class="m">2018</span>-12-07 <span class="m">16</span>:41:59,000<span class="o">]</span> Setting status of trial#2 as TrialState.FAIL because the <span class="se">\</span>
objective <span class="k">function</span> returned nan.
</pre></div>
</div>
</div>
<div class="section" id="what-happens-when-i-dynamically-alter-a-search-space">
<h2><a class="toc-backref" href="#id12">What happens when I dynamically alter a search space?</a><a class="headerlink" href="#what-happens-when-i-dynamically-alter-a-search-space" title="Permalink to this headline">¶</a></h2>
<p>Since parameters search spaces are specified in each call to the suggestion API, e.g.
<a class="reference internal" href="reference/trial.html#optuna.trial.Trial.suggest_uniform" title="optuna.trial.Trial.suggest_uniform"><code class="xref py py-func docutils literal notranslate"><span class="pre">suggest_uniform()</span></code></a> and <a class="reference internal" href="reference/trial.html#optuna.trial.Trial.suggest_int" title="optuna.trial.Trial.suggest_int"><code class="xref py py-func docutils literal notranslate"><span class="pre">suggest_int()</span></code></a>,
it is possible to in a single study alter the range by sampling parameters from different search
spaces in different trials.
The behavior when altered is defined by each sampler individually.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Discussion about the TPE sampler. <a class="reference external" href="https://github.com/optuna/optuna/issues/822">https://github.com/optuna/optuna/issues/822</a></p>
</div>
</div>
<div class="section" id="how-can-i-use-two-gpus-for-evaluating-two-trials-simultaneously">
<h2><a class="toc-backref" href="#id13">How can I use two GPUs for evaluating two trials simultaneously?</a><a class="headerlink" href="#how-can-i-use-two-gpus-for-evaluating-two-trials-simultaneously" title="Permalink to this headline">¶</a></h2>
<p>If your optimization target supports GPU (CUDA) acceleration and you want to specify which GPU is used, the easiest way is to set <code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES</span></code> environment variable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On a terminal.</span>
<span class="c1">#</span>
<span class="c1"># Specify to use the first GPU, and run an optimization.</span>
$ <span class="nb">export</span> <span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>
$ optuna study optimize foo.py objective --study foo --storage sqlite:///example.db

<span class="c1"># On another terminal.</span>
<span class="c1">#</span>
<span class="c1"># Specify to use the second GPU, and run another optimization.</span>
$ <span class="nb">export</span> <span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">1</span>
$ optuna study optimize bar.py objective --study bar --storage sqlite:///example.db
</pre></div>
</div>
<p>Please refer to <a class="reference external" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#env-vars">CUDA C Programming Guide</a> for further details.</p>
</div>
<div class="section" id="how-can-i-test-my-objective-functions">
<h2><a class="toc-backref" href="#id14">How can I test my objective functions?</a><a class="headerlink" href="#how-can-i-test-my-objective-functions" title="Permalink to this headline">¶</a></h2>
<p>When you test objective functions, you may prefer fixed parameter values to sampled ones.
In that case, you can use <a class="reference internal" href="reference/trial.html#optuna.trial.FixedTrial" title="optuna.trial.FixedTrial"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedTrial</span></code></a>, which suggests fixed parameter values based on a given dictionary of parameters.
For instance, you can input arbitrary values of <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> to the objective function <span class="math notranslate nohighlight">\(x + y\)</span> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_uniform</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">objective</span><span class="p">(</span><span class="n">FixedTrial</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}))</span>  <span class="c1"># 0.0</span>
<span class="n">objective</span><span class="p">(</span><span class="n">FixedTrial</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">}))</span>  <span class="c1"># -5.0</span>
</pre></div>
</div>
<p>Using <a class="reference internal" href="reference/trial.html#optuna.trial.FixedTrial" title="optuna.trial.FixedTrial"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedTrial</span></code></a>, you can write unit tests as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A test function of pytest</span>
<span class="k">def</span> <span class="nf">test_objective</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mf">1.0</span> <span class="o">==</span> <span class="n">objective</span><span class="p">(</span><span class="n">FixedTrial</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}))</span>
    <span class="k">assert</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">==</span> <span class="n">objective</span><span class="p">(</span><span class="n">FixedTrial</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}))</span>
    <span class="k">assert</span> <span class="mf">0.0</span> <span class="o">==</span> <span class="n">objective</span><span class="p">(</span><span class="n">FixedTrial</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="reference/visualization.html" class="btn btn-neutral float-left" title="Visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Optuna Contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <a href="privacy.html">Privacy Policy</a>.
     


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>